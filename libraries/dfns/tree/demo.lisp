;;; -*- Mode:Lisp; Syntax:ANSI-Common-Lisp; Coding:utf-8; Package:AprilLib.Dfns.Tree -*-
;;;; demo.lisp

(in-package :april-lib.dfns.tree)

(april-load (with (:space tree-lib-space))
            (asdf:system-relative-pathname (intern (package-name *package*) "KEYWORD") "tree.apl"))

(specify-demo
 "April tree demo"
 (with :space tree-lib-space
       :description "Implements tree modeling and processing functions from Dyalog's dfns.")
 (:tests (provision "put ← '∪' avl ⋄ rem ← '~' avl ⋄ get ← '⍎' avl")
         (provision "chk ← '?' avl ⋄ fmt ← '⍕' avl ⋄ vec ← '∊' avl")
         (provision "tree←0∘(put foldl)")
         (is "↓disp tree ⍳7" #("┌─┬─┬─────────────────────────────────────────────────────────┐"
                               "│4│0│┌───────────────────────────┬───────────────────────────┐│"
                               "│ │ ││┌─┬─┬─────────────────────┐│┌─┬─┬─────────────────────┐││"
                               "│ │ │││2│0│┌─────────┬─────────┐│││6│0│┌─────────┬─────────┐│││"
                               "│ │ │││ │ ││┌─┬─┬───┐│┌─┬─┬───┐││││ │ ││┌─┬─┬───┐│┌─┬─┬───┐││││"
                               "│ │ │││ │ │││1│0│0 0│││3│0│0 0│││││ │ │││5│0│0 0│││7│0│0 0│││││"
                               "│ │ │││ │ ││└─┴─┴───┘│└─┴─┴───┘││││ │ ││└─┴─┴───┘│└─┴─┴───┘││││"
                               "│ │ │││ │ │└─────────┴─────────┘│││ │ │└─────────┴─────────┘│││"
                               "│ │ ││└─┴─┴─────────────────────┘│└─┴─┴─────────────────────┘││"
                               "│ │ │└───────────────────────────┴───────────────────────────┘│"
                               "└─┴─┴─────────────────────────────────────────────────────────┘"))
         (is "↓fmt tree ⍳7" #("        ┌─1=1"
                              "   ┌─2=2┤    "
                              "   │    └─3=3"
                              "4=4┤         "
                              "   │    ┌─5=5"
                              "   └─6=6┤    "
                              "        └─7=7"))
         (provision "kseq ← 1↓¨,\\' ',12↑⎕a")
         (is "↓disp kseq"
             #("┌┬─┬──┬───┬────┬─────┬──────┬───────┬────────┬─────────┬──────────┬───────────┬────────────┐"
               "││A│AB│ABC│ABCD│ABCDE│ABCDEF│ABCDEFG│ABCDEFGH│ABCDEFGHI│ABCDEFGHIJ│ABCDEFGHIJK│ABCDEFGHIJKL│"
               "└┴─┴──┴───┴────┴─────┴──────┴───────┴────────┴─────────┴──────────┴───────────┴────────────┘"))
         (is "↓disp 4 3⍴1↓fmt∘tree¨kseq"
             #("┌──────────────────┬──────────────────┬──────────────────┐"
               "│A=A               │A=A┐              │   ┌─A=A          │"
               "│                  │   └>B=B          │B=B┤              │"
               "│                  │                  │   └─C=C          │"
               "├──────────────────┼──────────────────┼──────────────────┤"
               "│   ┌<A=A          │   ┌<A=A          │        ┌─A=A     │"
               "│B=B┤              │B=B┤              │   ┌─B=B┤         │"
               "│   └>C=C┐         │   │    ┌─C=C     │   │    └─C=C     │"
               "│        └>D=D     │   └>D=D┤         │D=D┤              │"
               "│                  │        └─E=E     │   └─E=E┐         │"
               "│                  │                  │        └>F=F     │"
               "├──────────────────┼──────────────────┼──────────────────┤"
               "│        ┌─A=A     │        ┌─A=A     │        ┌─A=A     │"
               "│   ┌─B=B┤         │   ┌<B=B┤         │   ┌<B=B┤         │"
               "│   │    └─C=C     │   │    └─C=C     │   │    └─C=C     │"
               "│D=D┤              │D=D┤              │D=D┤              │"
               "│   │    ┌─E=E     │   │    ┌<E=E     │   │    ┌<E=E     │"
               "│   └─F=F┤         │   └>F=F┤         │   └>F=F┤         │"
               "│        └─G=G     │        └>G=G┐    │        │    ┌─G=G│"
               "│                  │             └>H=H│        └>H=H┤    │"
               "│                  │                  │             └─I=I│"
               "├──────────────────┼──────────────────┼──────────────────┤"
               "│        ┌─A=A     │        ┌─A=A     │             ┌─A=A│"
               "│   ┌<B=B┤         │   ┌<B=B┤         │        ┌─B=B┤    │"
               "│   │    └─C=C     │   │    └─C=C     │        │    └─C=C│"
               "│D=D┤              │D=D┤              │   ┌─D=D┤         │"
               "│   │         ┌─E=E│   │         ┌─E=E│   │    │    ┌─E=E│"
               "│   │    ┌─F=F┤    │   │    ┌─F=F┤    │   │    └─F=F┤    │"
               "│   │    │    └─G=G│   │    │    └─G=G│   │         └─G=G│"
               "│   └>H=H┤         │   └>H=H┤         │H=H┤              │"
               "│        └─I=I┐    │        │    ┌─I=I│   │    ┌<I=I     │"
               "│             └>J=J│        └─J=J┤    │   └─J=J┤         │"
               "│                  │             └─K=K│        └>K=K┐    │"
               "│                  │                  │             └>L=L│"
               "└──────────────────┴──────────────────┴──────────────────┘"))
         ;; (is "↓disp 4 3⍴(tree 12↑⎕a){fmt ⍶ rem foldl ⍵}¨kseq"
         ;;     #("┌──────────────────┬──────────────────┬──────────────────┐"
         ;;       "│             ┌─A=A│        ┌─B=B┐    │        ┌<C=C     │"
         ;;       "│        ┌─B=B┤    │        │    └>C=C│   ┌─D=D┤         │"
         ;;       "│        │    └─C=C│   ┌─D=D┤         │   │    │    ┌─E=E│"
         ;;       "│   ┌─D=D┤         │   │    │    ┌─E=E│   │    └>F=F┤    │"
         ;;       "│   │    │    ┌─E=E│   │    └─F=F┤    │   │         └─G=G│"
         ;;       "│   │    └─F=F┤    │   │         └─G=G│H=H┤              │"
         ;;       "│   │         └─G=G│H=H┤              │   │    ┌<I=I     │"
         ;;       "│H=H┤              │   │    ┌<I=I     │   └─J=J┤         │"
         ;;       "│   │    ┌<I=I     │   └─J=J┤         │        └>K=K┐    │"
         ;;       "│   └─J=J┤         │        └>K=K┐    │             └>L=L│"
         ;;       "│        └>K=K┐    │             └>L=L│                  │"
         ;;       "│             └>L=L│                  │                  │"
         ;;       "├──────────────────┼──────────────────┼──────────────────┤"
         ;;       "│        ┌>D=D┐    │        ┌─E=E     │   ┌<F=F┐         │"
         ;;       "│        │    └>E=E│   ┌<F=F┤         │   │    └>G=G     │"
         ;;       "│   ┌─F=F┤         │   │    └─G=G     │H=H┤              │"
         ;;       "│   │    └<G=G     │H=H┤              │   │    ┌<I=I     │"
         ;;       "│H=H┤              │   │    ┌<I=I     │   └>J=J┤         │"
         ;;       "│   │    ┌<I=I     │   └>J=J┤         │        └>K=K┐    │"
         ;;       "│   └─J=J┤         │        └>K=K┐    │             └>L=L│"
         ;;       "│        └>K=K┐    │             └>L=L│                  │"
         ;;       "│             └>L=L│                  │                  │"
         ;;       "├──────────────────┼──────────────────┼──────────────────┤"
         ;;       "│        ┌─G=G     │   ┌─H=H┐         │   ┌<I=I          │"
         ;;       "│   ┌─H=H┤         │   │    └>I=I     │J=J┤              │"
         ;;       "│   │    └─I=I     │J=J┤              │   └>K=K┐         │"
         ;;       "│J=J┤              │   └─K=K┐         │        └>L=L     │"
         ;;       "│   └─K=K┐         │        └>L=L     │                  │"
         ;;       "│        └>L=L     │                  │                  │"
         ;;       "├──────────────────┼──────────────────┼──────────────────┤"
         ;;       "│   ┌─J=J          │K=K┐              │L=L               │"
         ;;       "│K=K┤              │   └>L=L          │                  │"
         ;;       "│   └─L=L          │                  │                  │"
         ;;       "└──────────────────┴──────────────────┴──────────────────┘"))
         ;; (is "↓disp 4 3⍴(tree 12↑⎕a){fmt ⍶ rem foldl ⍵}¨,\\' HIJDEF2GKBCLA'"
         ;;     #("┌──────────────────┬──────────────────┬──────────────────┐"
         ;;       "│             ┌─A=A│             ┌─A=A│             ┌─A=A│"
         ;;       "│        ┌─B=B┤    │        ┌─B=B┤    │        ┌─B=B┤    │"
         ;;       "│        │    └─C=C│        │    └─C=C│        │    └─C=C│"
         ;;       "│   ┌─D=D┤         │   ┌>D=D┤         │   ┌>D=D┤         │"
         ;;       "│   │    │    ┌─E=E│   │    │    ┌─E=E│   │    │    ┌─E=E│"
         ;;       "│   │    └─F=F┤    │   │    └─F=F┤    │   │    └─F=F┤    │"
         ;;       "│   │         └─G=G│   │         └─G=G│   │         └─G=G│"
         ;;       "│H=H┤              │I=I┤              │J=J┤              │"
         ;;       "│   │    ┌<I=I     │   │    ┌─J=J     │   └<K=K┐         │"
         ;;       "│   └─J=J┤         │   └<K=K┤         │        └>L=L     │"
         ;;       "│        └>K=K┐    │        └─L=L     │                  │"
         ;;       "│             └>L=L│                  │                  │"
         ;;       "├──────────────────┼──────────────────┼──────────────────┤"
         ;;       "│        ┌─A=A     │        ┌─A=A     │        ┌─A=A     │"
         ;;       "│   ┌<B=B┤         │   ┌<B=B┤         │   ┌─B=B┤         │"
         ;;       "│   │    └─C=C     │   │    └─C=C     │   │    └─C=C     │"
         ;;       "│D=D┤              │E=E┤              │F=F┤              │"
         ;;       "│   │         ┌─E=E│   │    ┌>F=F┐    │   │    ┌─G=G     │"
         ;;       "│   │    ┌>F=F┤    │   │    │    └>G=G│   └─K=K┤         │"
         ;;       "│   │    │    └─G=G│   └>K=K┤         │        └─L=L     │"
         ;;       "│   └>K=K┤         │        └<L=L     │                  │"
         ;;       "│        └<L=L     │                  │                  │"
         ;;       "├──────────────────┼──────────────────┼──────────────────┤"
         ;;       "│        ┌─A=A     │        ┌─A=A     │   ┌<A=A          │"
         ;;       "│   ┌─B=B┤         │   ┌>B=B┤         │B=B┤              │"
         ;;       "│   │    └─C=C     │   │    └─C=C     │   │    ┌>C=C     │"
         ;;       "│G=G┤              │K=K┤              │   └>L=L┘         │"
         ;;       "│   └─K=K┐         │   └<L=L          │                  │"
         ;;       "│        └>L=L     │                  │                  │"
         ;;       "├──────────────────┼──────────────────┼──────────────────┤"
         ;;       "│   ┌─A=A          │   ┌>A=A          │A=A               │"
         ;;       "│C=C┤              │L=L┘              │                  │"
         ;;       "│   └─L=L          │                  │                  │"
         ;;       "└──────────────────┴──────────────────┴──────────────────┘"))
         (is "↓display fmt tree ⎕a" #("┌→──────────────────────┐"
                                      "↓                  ┌─A=A│"
                                      "│             ┌─B=B┤    │"
                                      "│             │    └─C=C│"
                                      "│        ┌─D=D┤         │"
                                      "│        │    │    ┌─E=E│"
                                      "│        │    └─F=F┤    │"
                                      "│        │         └─G=G│"
                                      "│   ┌─H=H┤              │"
                                      "│   │    │         ┌─I=I│"
                                      "│   │    │    ┌─J=J┤    │"
                                      "│   │    │    │    └─K=K│"
                                      "│   │    └─L=L┤         │"
                                      "│   │         │    ┌─M=M│"
                                      "│   │         └─N=N┤    │"
                                      "│   │              └─O=O│"
                                      "│P=P┤                   │"
                                      "│   │         ┌─Q=Q     │"
                                      "│   │    ┌<R=R┤         │"
                                      "│   │    │    └─S=S     │"
                                      "│   └─T=T┤              │"
                                      "│        │         ┌─U=U│"
                                      "│        │    ┌─V=V┤    │"
                                      "│        │    │    └─W=W│"
                                      "│        └>X=X┤         │"
                                      "│             └─Y=Y┐    │"
                                      "│                  └>Z=Z│"
                                      "└───────────────────────┘"))
         (is "↓disp fmt¨ ∪ tree¨↓pmat 5"
             #("┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────┬─────────────┐"
               "│   ┌<1=1     │   ┌─1=1┐    │   ┌─1=1┐    │        ┌─1=1│        ┌>1=1│        ┌>1=1│"
               "│2=2┤         │   │    └>2=2│   │    └>2=2│   ┌>2=2┤    │   ┌─2=2┘    │   ┌─2=2┘    │"
               "│   │    ┌─3=3│3=3┤         │3=3┤         │   │    └─3=3│3=3┤         │3=3┤         │"
               "│   └>4=4┤    │   └─4=4┐    │   │    ┌>4=4│4=4┤         │   └─4=4┐    │   │    ┌>4=4│"
               "│        └─5=5│        └>5=5│   └─5=5┘    │   └<5=5     │        └>5=5│   └─5=5┘    │"
               "└─────────────┴─────────────┴─────────────┴─────────────┴─────────────┴─────────────┘"))
         (provision "tt←tree ('one'1) ('two'2) ('three'3) ('four'4) ('five'5) ('six'6) ('seven'7)")
         (is "↓display fmt tt" #("┌→─────────────────────────────┐"
                                 "↓             ┌>five=5         │"
                                 "│     ┌<four=4┘                │"
                                 "│one=1┤                        │"
                                 "│     │               ┌>seven=7│"
                                 "│     │        ┌>six=6┘        │"
                                 "│     └>three=3┤               │"
                                 "│              └<two=2         │"
                                 "└──────────────────────────────┘"))
         (is "↓disp vec tt"
             #("┌────────┬────────┬───────┬─────────┬───────┬─────────┬───────┐"
               "│┌────┬─┐│┌────┬─┐│┌───┬─┐│┌─────┬─┐│┌───┬─┐│┌─────┬─┐│┌───┬─┐│"
               "││five│5│││four│4│││one│1│││seven│7│││six│6│││three│3│││two│2││"
               "│└────┴─┘│└────┴─┘│└───┴─┘│└─────┴─┘│└───┴─┘│└─────┴─┘│└───┴─┘│"
               "└────────┴────────┴───────┴─────────┴───────┴─────────┴───────┘"))
         (provision "tt ← tt put foldl ('one' 11)('two' 22)('three'33)")
         (is "↓display fmt tt" #("┌→───────────────────────────────┐"
                                 "↓              ┌>five=5          │"
                                 "│      ┌<four=4┘                 │"
                                 "│one=11┤                         │"
                                 "│      │                ┌>seven=7│"
                                 "│      │         ┌>six=6┘        │"
                                 "│      └>three=33┤               │"
                                 "│                └<two=22        │"
                                 "└────────────────────────────────┘"))
         (is "0 ≡ tt rem foldl 'seven' 'six' 'five' 'four' 'one' 'two' 'three'" 1)
         (is "0 ≡ tt rem foldl 'six' 'four' 'seven' 'three' 'five' 'one' 'two'" 1)
         (is "tt∘get¨ 'two' 'four' 'six'" #(22 4 6))
         (is "chk tt" #(1 7 2 4))
         (is "↓display fmt fibtree 7" #("┌→──────────────────────────────────────────────┐"
                                        "↓               ┌<1=1                           │"
                                        "│          ┌<2=2┤                               │"
                                        "│          │    └>3=3┐                          │"
                                        "│          │         └>4=4                      │"
                                        "│     ┌<5=5┤                                    │"
                                        "│     │    │    ┌<6=6┐                          │"
                                        "│     │    │    │    └>7=7                      │"
                                        "│     │    └>8=8┤                               │"
                                        "│     │         │      ┌<9=9                    │"
                                        "│     │         └>10=10┤                        │"
                                        "│     │                └>11=11┐                 │"
                                        "│     │                       └>12=12           │"
                                        "│13=13┤                                         │"
                                        "│     │             ┌<14=14┐                    │"
                                        "│     │             │      └>15=15              │"
                                        "│     │      ┌<16=16┤                           │"
                                        "│     │      │      │      ┌<17=17              │"
                                        "│     │      │      └>18=18┤                    │"
                                        "│     │      │             └>19=19┐             │"
                                        "│     │      │                    └>20=20       │"
                                        "│     └>21=21┤                                  │"
                                        "│            │             ┌<22=22              │"
                                        "│            │      ┌<23=23┤                    │"
                                        "│            │      │      └>24=24┐             │"
                                        "│            │      │             └>25=25       │"
                                        "│            └>26=26┤                           │"
                                        "│                   │      ┌<27=27┐             │"
                                        "│                   │      │      └>28=28       │"
                                        "│                   └>29=29┤                    │"
                                        "│                          │      ┌<30=30       │"
                                        "│                          └>31=31┤             │"
                                        "│                                 └>32=32┐      │"
                                        "│                                        └>33=33│"
                                        "└───────────────────────────────────────────────┘"))
         (is "↓display fmt (fibtree 7) rem 1" #("┌→───────────────────────────────────────┐"
                                                "↓                           ┌─2=2        │"
                                                "│                      ┌─3=3┤            │"
                                                "│                      │    └─4=4        │"
                                                "│                 ┌─5=5┤                 │"
                                                "│                 │    └─6=6┐            │"
                                                "│                 │         └>7=7        │"
                                                "│            ┌─8=8┤                      │"
                                                "│            │    │      ┌<9=9           │"
                                                "│            │    └─10=10┤               │"
                                                "│            │           └>11=11┐        │"
                                                "│            │                  └>12=12  │"
                                                "│     ┌─13=13┤                           │"
                                                "│     │      │      ┌<14=14┐             │"
                                                "│     │      │      │      └>15=15       │"
                                                "│     │      └─16=16┤                    │"
                                                "│     │             │      ┌<17=17       │"
                                                "│     │             └>18=18┤             │"
                                                "│     │                    └>19=19┐      │"
                                                "│     │                           └>20=20│"
                                                "│21=21┤                                  │"
                                                "│     │             ┌<22=22              │"
                                                "│     │      ┌<23=23┤                    │"
                                                "│     │      │      └>24=24┐             │"
                                                "│     │      │             └>25=25       │"
                                                "│     └─26=26┤                           │"
                                                "│            │      ┌<27=27┐             │"
                                                "│            │      │      └>28=28       │"
                                                "│            └>29=29┤                    │"
                                                "│                   │      ┌<30=30       │"
                                                "│                   └>31=31┤             │"
                                                "│                          └>32=32┐      │"
                                                "│                                 └>33=33│"
                                                "└────────────────────────────────────────┘"))
         (provision "put ← '∪' sbst ⋄ get ← '⍎' sbst ⋄ rem ← '~' sbst")
         (provision "fmt ← '⍕' sbst ⋄ chk ← '?' sbst ⋄ vec ← '∊' sbst ⋄ bal ← '=' sbst")
         (provision "tree←0∘(put foldl)")
         (is "↓fmt tree ⍳15"
             #("1=1┐                                                                   "
               "   └2=2┐                                                               "
               "       └3=3┐                                                           "
               "           └4=4┐                                                       "
               "               └5=5┐                                                   "
               "                   └6=6┐                                               "
               "                       └7=7┐                                           "
               "                           └8=8┐                                       "
               "                               └9=9┐                                   "
               "                                   └10=10┐                             "
               "                                         └11=11┐                       "
               "                                               └12=12┐                 "
               "                                                     └13=13┐           "
               "                                                           └14=14┐     "
               "                                                                 └15=15"))
         (is "↓fmt bal tree 15?15" #("           ┌1=1      "
                                     "       ┌2=2┤         "
                                     "       │   └3=3      "
                                     "   ┌4=4┤             "
                                     "   │   │   ┌5=5      "
                                     "   │   └6=6┤         "
                                     "   │       └7=7      "
                                     "8=8┤                 "
                                     "   │           ┌9=9  "
                                     "   │     ┌10=10┤     "
                                     "   │     │     └11=11"
                                     "   └12=12┤           "
                                     "         │     ┌13=13"
                                     "         └14=14┤     "
                                     "               └15=15"))
         (is "↓fmt tree 'jackdaws love my big sphinx of quartz'~' '"
             #("   ┌a=a┐                           "
               "   │   │   ┌b=b                    "
               "   │   └c=c┤                       "
               "   │       └d=d┐                   "
               "   │           └e=e┐               "
               "   │               │       ┌f=f    "
               "   │               │   ┌g=g┤       "
               "   │               │   │   └h=h    "
               "   │               └i=i┘           "
               "j=j┤                               "
               "   └k=k┐                           "
               "       │       ┌l=l┐               "
               "       │       │   │   ┌m=m┐       "
               "       │       │   │   │   └n=n    "
               "       │       │   └o=o┤           "
               "       │       │       └p=p┐       "
               "       │       │           └q=q┐   "
               "       │       │               └r=r"
               "       │   ┌s=s┤                   "
               "       │   │   │       ┌t=t        "
               "       │   │   │   ┌u=u┘           "
               "       │   │   └v=v┘               "
               "       └w=w┤                       "
               "           │   ┌x=x                "
               "           └y=y┤                   "
               "               └z=z                "))
         (is "↓fmt bal tree 'jackdaws love my big sphinx of quartz'~' '"
             #("           ┌a=a    "
               "       ┌b=b┤       "
               "       │   └c=c    "
               "   ┌d=d┤           "
               "   │   │   ┌e=e┐   "
               "   │   │   │   └f=f"
               "   │   └g=g┤       "
               "   │       │   ┌h=h"
               "   │       └i=i┤   "
               "   │           └j=j"
               "k=k┤               "
               "   │           ┌l=l"
               "   │       ┌m=m┤   "
               "   │       │   └n=n"
               "   │   ┌o=o┤       "
               "   │   │   │   ┌p=p"
               "   │   │   └q=q┤   "
               "   │   │       └r=r"
               "   └s=s┤           "
               "       │       ┌t=t"
               "       │   ┌u=u┤   "
               "       │   │   └v=v"
               "       └w=w┤       "
               "           │   ┌x=x"
               "           └y=y┤   "
               "               └z=z"))
         (is "↓disp 7 4⍴{fmt bal 0 put foldl ⍵}¨ 1↓¨,\\' ',⎕a"
             #("┌───────────────────┬───────────────────┬───────────────────┬───────────────────┐"
               "│                   │A=A                │A=A┐               │   ┌A=A            │"
               "│                   │                   │   └B=B            │B=B┤               │"
               "│                   │                   │                   │   └C=C            │"
               "├───────────────────┼───────────────────┼───────────────────┼───────────────────┤"
               "│   ┌A=A            │   ┌A=A            │   ┌A=A┐           │       ┌A=A        │"
               "│B=B┤               │B=B┤               │   │   └B=B        │   ┌B=B┤           │"
               "│   └C=C┐           │   │   ┌C=C        │C=C┤               │   │   └C=C        │"
               "│       └D=D        │   └D=D┤           │   │   ┌D=D        │D=D┤               │"
               "│                   │       └E=E        │   └E=E┤           │   │   ┌E=E        │"
               "│                   │                   │       └F=F        │   └F=F┤           │"
               "│                   │                   │                   │       └G=G        │"
               "├───────────────────┼───────────────────┼───────────────────┼───────────────────┤"
               "│       ┌A=A        │       ┌A=A        │       ┌A=A        │       ┌A=A        │"
               "│   ┌B=B┤           │   ┌B=B┤           │   ┌B=B┤           │   ┌B=B┤           │"
               "│   │   └C=C        │   │   └C=C        │   │   └C=C        │   │   └C=C        │"
               "│D=D┤               │D=D┤               │D=D┤               │D=D┤               │"
               "│   │   ┌E=E        │   │   ┌E=E        │   │   ┌E=E┐       │   │       ┌E=E    │"
               "│   └F=F┤           │   └F=F┤           │   │   │   └F=F    │   │   ┌F=F┤       │"
               "│       └G=G┐       │       │   ┌G=G    │   └G=G┤           │   │   │   └G=G    │"
               "│           └H=H    │       └H=H┤       │       │   ┌H=H    │   └H=H┤           │"
               "│                   │           └I=I    │       └I=I┤       │       │   ┌I=I    │"
               "│                   │                   │           └J=J    │       └J=J┤       │"
               "│                   │                   │                   │           └K=K    │"
               "├───────────────────┼───────────────────┼───────────────────┼───────────────────┤"
               "│       ┌A=A        │       ┌A=A        │       ┌A=A┐       │           ┌A=A    │"
               "│   ┌B=B┤           │   ┌B=B┤           │       │   └B=B    │       ┌B=B┤       │"
               "│   │   └C=C┐       │   │   │   ┌C=C    │   ┌C=C┤           │       │   └C=C    │"
               "│   │       └D=D    │   │   └D=D┤       │   │   │   ┌D=D    │   ┌D=D┤           │"
               "│E=E┤               │   │       └E=E    │   │   └E=E┤       │   │   │   ┌E=E    │"
               "│   │       ┌F=F    │F=F┤               │   │       └F=F    │   │   └F=F┤       │"
               "│   │   ┌G=G┤       │   │       ┌G=G    │G=G┤               │   │       └G=G    │"
               "│   │   │   └H=H    │   │   ┌H=H┤       │   │       ┌H=H    │H=H┤               │"
               "│   └I=I┤           │   │   │   └I=I    │   │   ┌I=I┤       │   │       ┌I=I    │"
               "│       │   ┌J=J    │   └J=J┤           │   │   │   └J=J    │   │   ┌J=J┤       │"
               "│       └K=K┤       │       │   ┌K=K    │   └K=K┤           │   │   │   └K=K    │"
               "│           └L=L    │       └L=L┤       │       │   ┌L=L    │   └L=L┤           │"
               "│                   │           └M=M    │       └M=M┤       │       │   ┌M=M    │"
               "│                   │                   │           └N=N    │       └N=N┤       │"
               "│                   │                   │                   │           └O=O    │"
               "├───────────────────┼───────────────────┼───────────────────┼───────────────────┤"
               "│           ┌A=A    │           ┌A=A    │           ┌A=A    │           ┌A=A    │"
               "│       ┌B=B┤       │       ┌B=B┤       │       ┌B=B┤       │       ┌B=B┤       │"
               "│       │   └C=C    │       │   └C=C    │       │   └C=C    │       │   └C=C    │"
               "│   ┌D=D┤           │   ┌D=D┤           │   ┌D=D┤           │   ┌D=D┤           │"
               "│   │   │   ┌E=E    │   │   │   ┌E=E    │   │   │   ┌E=E    │   │   │   ┌E=E    │"
               "│   │   └F=F┤       │   │   └F=F┤       │   │   └F=F┤       │   │   └F=F┤       │"
               "│   │       └G=G    │   │       └G=G    │   │       └G=G    │   │       └G=G    │"
               "│H=H┤               │H=H┤               │H=H┤               │H=H┤               │"
               "│   │       ┌I=I    │   │       ┌I=I    │   │       ┌I=I    │   │       ┌I=I    │"
               "│   │   ┌J=J┤       │   │   ┌J=J┤       │   │   ┌J=J┤       │   │   ┌J=J┤       │"
               "│   │   │   └K=K    │   │   │   └K=K    │   │   │   └K=K    │   │   │   └K=K    │"
               "│   └L=L┤           │   └L=L┤           │   └L=L┤           │   └L=L┤           │"
               "│       │   ┌M=M    │       │   ┌M=M    │       │   ┌M=M┐   │       │       ┌M=M│"
               "│       └N=N┤       │       └N=N┤       │       │   │   └N=N│       │   ┌N=N┤   │"
               "│           └O=O┐   │           │   ┌O=O│       └O=O┤       │       │   │   └O=O│"
               "│               └P=P│           └P=P┤   │           │   ┌P=P│       └P=P┤       │"
               "│                   │               └Q=Q│           └Q=Q┤   │           │   ┌Q=Q│"
               "│                   │                   │               └R=R│           └R=R┤   │"
               "│                   │                   │                   │               └S=S│"
               "├───────────────────┼───────────────────┼───────────────────┼───────────────────┤"
               "│           ┌A=A    │           ┌A=A    │           ┌A=A    │           ┌A=A    │"
               "│       ┌B=B┤       │       ┌B=B┤       │       ┌B=B┤       │       ┌B=B┤       │"
               "│       │   └C=C    │       │   └C=C    │       │   └C=C    │       │   └C=C    │"
               "│   ┌D=D┤           │   ┌D=D┤           │   ┌D=D┤           │   ┌D=D┤           │"
               "│   │   │   ┌E=E    │   │   │   ┌E=E    │   │   │   ┌E=E    │   │   │   ┌E=E    │"
               "│   │   └F=F┤       │   │   └F=F┤       │   │   └F=F┤       │   │   └F=F┤       │"
               "│   │       └G=G    │   │       └G=G    │   │       └G=G    │   │       └G=G    │"
               "│H=H┤               │H=H┤               │H=H┤               │H=H┤               │"
               "│   │       ┌I=I    │   │       ┌I=I    │   │       ┌I=I┐   │   │           ┌I=I│"
               "│   │   ┌J=J┤       │   │   ┌J=J┤       │   │       │   └J=J│   │       ┌J=J┤   │"
               "│   │   │   └K=K┐   │   │   │   │   ┌K=K│   │   ┌K=K┤       │   │       │   └K=K│"
               "│   │   │       └L=L│   │   │   └L=L┤   │   │   │   │   ┌L=L│   │   ┌L=L┤       │"
               "│   └M=M┤           │   │   │       └M=M│   │   │   └M=M┤   │   │   │   │   ┌M=M│"
               "│       │       ┌N=N│   └N=N┤           │   │   │       └N=N│   │   │   └N=N┤   │"
               "│       │   ┌O=O┤   │       │       ┌O=O│   └O=O┤           │   │   │       └O=O│"
               "│       │   │   └P=P│       │   ┌P=P┤   │       │       ┌P=P│   └P=P┤           │"
               "│       └Q=Q┤       │       │   │   └Q=Q│       │   ┌Q=Q┤   │       │       ┌Q=Q│"
               "│           │   ┌R=R│       └R=R┤       │       │   │   └R=R│       │   ┌R=R┤   │"
               "│           └S=S┤   │           │   ┌S=S│       └S=S┤       │       │   │   └S=S│"
               "│               └T=T│           └T=T┤   │           │   ┌T=T│       └T=T┤       │"
               "│                   │               └U=U│           └U=U┤   │           │   ┌U=U│"
               "│                   │                   │               └V=V│           └V=V┤   │"
               "│                   │                   │                   │               └W=W│"
               "├───────────────────┼───────────────────┼───────────────────┼───────────────────┤"
               "│           ┌A=A    │           ┌A=A    │           ┌A=A    │                   │"
               "│       ┌B=B┤       │       ┌B=B┤       │       ┌B=B┤       │                   │"
               "│       │   └C=C    │       │   └C=C    │       │   └C=C    │                   │"
               "│   ┌D=D┤           │   ┌D=D┤           │   ┌D=D┤           │                   │"
               "│   │   │   ┌E=E    │   │   │   ┌E=E    │   │   │   ┌E=E┐   │                   │"
               "│   │   └F=F┤       │   │   └F=F┤       │   │   │   │   └F=F│                   │"
               "│   │       └G=G┐   │   │       │   ┌G=G│   │   └G=G┤       │                   │"
               "│   │           └H=H│   │       └H=H┤   │   │       │   ┌H=H│                   │"
               "│I=I┤               │   │           └I=I│   │       └I=I┤   │                   │"
               "│   │           ┌J=J│J=J┤               │   │           └J=J│                   │"
               "│   │       ┌K=K┤   │   │           ┌K=K│K=K┤               │                   │"
               "│   │       │   └L=L│   │       ┌L=L┤   │   │           ┌L=L│                   │"
               "│   │   ┌M=M┤       │   │       │   └M=M│   │       ┌M=M┤   │                   │"
               "│   │   │   │   ┌N=N│   │   ┌N=N┤       │   │       │   └N=N│                   │"
               "│   │   │   └O=O┤   │   │   │   │   ┌O=O│   │   ┌O=O┤       │                   │"
               "│   │   │       └P=P│   │   │   └P=P┤   │   │   │   │   ┌P=P│                   │"
               "│   └Q=Q┤           │   │   │       └Q=Q│   │   │   └Q=Q┤   │                   │"
               "│       │       ┌R=R│   └R=R┤           │   │   │       └R=R│                   │"
               "│       │   ┌S=S┤   │       │       ┌S=S│   └S=S┤           │                   │"
               "│       │   │   └T=T│       │   ┌T=T┤   │       │       ┌T=T│                   │"
               "│       └U=U┤       │       │   │   └U=U│       │   ┌U=U┤   │                   │"
               "│           │   ┌V=V│       └V=V┤       │       │   │   └V=V│                   │"
               "│           └W=W┤   │           │   ┌W=W│       └W=W┤       │                   │"
               "│               └X=X│           └X=X┤   │           │   ┌X=X│                   │"
               "│                   │               └Y=Y│           └Y=Y┤   │                   │"
               "│                   │                   │               └Z=Z│                   │"
               "└───────────────────┴───────────────────┴───────────────────┴───────────────────┘"))
         (provision "tt←0 put foldl ('one'1) ('two'2) ('three'3) ('four'4) ('five'5) ('six'6) ('seven'7)")
         (is "↓fmt tt" #("            ┌five=5              "
                         "     ┌four=4┘                    "
                         "one=1┤                           "
                         "     │                   ┌seven=7"
                         "     │             ┌six=6┘       "
                         "     │     ┌three=3┘             "
                         "     └two=2┘                     "))
         (provision "tt←bal tt")
         (is "↓fmt tt" #("              ┌five=5"
                         "       ┌four=4┤      "
                         "       │      └one=1 "
                         "seven=7┤             "
                         "       │       ┌six=6"
                         "       └three=3┤     "
                         "               └two=2"))
         (is "'six' get tt" 6)
         (provision "tt←tt rem 'four'")
         (is "↓fmt tt" #("       ┌five=5┐      "
                         "       │      └one=1 "
                         "seven=7┤             "
                         "       │       ┌six=6"
                         "       └three=3┤     "
                         "               └two=2"))
         (is "↓disp vec tt" #("┌────────┬───────┬─────────┬───────┬─────────┬───────┐"
                              "│┌────┬─┐│┌───┬─┐│┌─────┬─┐│┌───┬─┐│┌─────┬─┐│┌───┬─┐│"
                              "││five│5│││one│1│││seven│7│││six│6│││three│3│││two│2││"
                              "│└────┴─┘│└───┴─┘│└─────┴─┘│└───┴─┘│└─────┴─┘│└───┴─┘│"
                              "└────────┴───────┴─────────┴───────┴─────────┴───────┘"))
         (is "chk tt" #(1 6 1 3))
         (provision "put ← '∪' redblack ⋄ rem ← '~' redblack ⋄ get ← '⍎' redblack")
         (provision "fmt ← '⍕' redblack ⋄ vec ← '∊' redblack ⋄ chk ← '?' redblack")
         (provision "tree←0∘(put foldl)")
         (provision "pairs ← ('one'1) ('two'2) ('three'3) ('four'4) ('five'5) ('six'6) ('seven'7)")
         (provision "tt ← tree pairs")
         (is "↓fmt tt" #("                           ┌[∘]         "
                         "                  ┌[five=5]┤            "
                         "                  │        └[∘]         "
                         "         ┌<four=4>┤                     "
                         "         │        │                 ┌[∘]"
                         "         │        │         ┌<one=1>┤   "
                         "         │        │         │       └[∘]"
                         "         │        └[seven=7]┤           "
                         "         │                  │       ┌[∘]"
                         "         │                  └<six=6>┤   "
                         "         │                          └[∘]"
                         "[three=3]┤                              "
                         "         │       ┌[∘]                   "
                         "         └[two=2]┤                      "
                         "                 └[∘]                   "))
         (is "chk tt" #(1 7 2 4))
         (is "'two' get tt" 2)
         (is "↓disp vec tt" #("┌────────┬────────┬───────┬─────────┬───────┬─────────┬───────┐"
                              "│┌────┬─┐│┌────┬─┐│┌───┬─┐│┌─────┬─┐│┌───┬─┐│┌─────┬─┐│┌───┬─┐│"
                              "││five│5│││four│4│││one│1│││seven│7│││six│6│││three│3│││two│2││"
                              "│└────┴─┘│└────┴─┘│└───┴─┘│└─────┴─┘│└───┴─┘│└─────┴─┘│└───┴─┘│"
                              "└────────┴────────┴───────┴─────────┴───────┴─────────┴───────┘"))
         (is "↓fmt tree ⍳15" #("                 ┌[∘]                          "
                               "           ┌[1=1]┤                             "
                               "           │     └[∘]                          "
                               "     ┌[2=2]┤                                   "
                               "     │     │     ┌[∘]                          "
                               "     │     └[3=3]┤                             "
                               "     │           └[∘]                          "
                               "[4=4]┤                                         "
                               "     │                 ┌[∘]                    "
                               "     │           ┌[5=5]┤                       "
                               "     │           │     └[∘]                    "
                               "     │     ┌[6=6]┤                             "
                               "     │     │     │     ┌[∘]                    "
                               "     │     │     └[7=7]┤                       "
                               "     │     │           └[∘]                    "
                               "     └<8=8>┤                                   "
                               "           │             ┌[∘]                  "
                               "           │       ┌[9=9]┤                     "
                               "           │       │     └[∘]                  "
                               "           └[10=10]┤                           "
                               "                   │               ┌[∘]        "
                               "                   │       ┌[11=11]┤           "
                               "                   │       │       └[∘]        "
                               "                   └<12=12>┤                   "
                               "                           │               ┌[∘]"
                               "                           │       ┌<13=13>┤   "
                               "                           │       │       └[∘]"
                               "                           └[14=14]┤           "
                               "                                   │       ┌[∘]"
                               "                                   └<15=15>┤   "
                               "                                           └[∘]"))
         (provision "⎕rl ← 1")
         (provision "vv  ← 100?100")
         (provision "tt  ← tree vv")
         (is "chk tt" #(1 100 5 8))
         (is "vv ≡ vv get¨⊂tt" 1)
         (is "(⍳⍴vv) ≡ vec tt" 1)
         (provision "tt ← tree ⍳7")
         (is "∧/⊃∘chk¨tt∘rem¨ ⍳7" 1)
         (is
          "↓disp 4 3⍴fmt∘tree¨kseq"
          #("┌───────────────────────────┬─────────────────────────────────┬─────────────────────────────────┐"
            "│[∘]                        │     ┌[∘]                        │     ┌[∘]                        │"
            "│                           │[A=A]┤                           │[A=A]┤                           │"
            "│                           │     └[∘]                        │     │     ┌[∘]                  │"
            "│                           │                                 │     └<B=B>┤                     │"
            "│                           │                                 │           └[∘]                  │"
            "├───────────────────────────┼─────────────────────────────────┼─────────────────────────────────┤"
            "│           ┌[∘]            │           ┌[∘]                  │           ┌[∘]                  │"
            "│     ┌<A=A>┤               │     ┌[A=A]┤                     │     ┌[A=A]┤                     │"
            "│     │     └[∘]            │     │     └[∘]                  │     │     └[∘]                  │"
            "│[B=B]┤                     │[B=B]┤                           │[B=B]┤                           │"
            "│     │     ┌[∘]            │     │     ┌[∘]                  │     │           ┌[∘]            │"
            "│     └<C=C>┤               │     └[C=C]┤                     │     │     ┌<C=C>┤               │"
            "│           └[∘]            │           │     ┌[∘]            │     │     │     └[∘]            │"
            "│                           │           └<D=D>┤               │     └[D=D]┤                     │"
            "│                           │                 └[∘]            │           │     ┌[∘]            │"
            "│                           │                                 │           └<E=E>┤               │"
            "│                           │                                 │                 └[∘]            │"
            "├───────────────────────────┼─────────────────────────────────┼─────────────────────────────────┤"
            "│           ┌[∘]            │           ┌[∘]                  │                 ┌[∘]            │"
            "│     ┌[A=A]┤               │     ┌[A=A]┤                     │           ┌[A=A]┤               │"
            "│     │     └[∘]            │     │     └[∘]                  │           │     └[∘]            │"
            "│[B=B]┤                     │[B=B]┤                           │     ┌<B=B>┤                     │"
            "│     │           ┌[∘]      │     │           ┌[∘]            │     │     │     ┌[∘]            │"
            "│     │     ┌[C=C]┤         │     │     ┌[C=C]┤               │     │     └[C=C]┤               │"
            "│     │     │     └[∘]      │     │     │     └[∘]            │     │           └[∘]            │"
            "│     └<D=D>┤               │     └<D=D>┤                     │[D=D]┤                           │"
            "│           │     ┌[∘]      │           │           ┌[∘]      │     │           ┌[∘]            │"
            "│           └[E=E]┤         │           │     ┌<E=E>┤         │     │     ┌[E=E]┤               │"
            "│                 │     ┌[∘]│           │     │     └[∘]      │     │     │     └[∘]            │"
            "│                 └<F=F>┤   │           └[F=F]┤               │     └<F=F>┤                     │"
            "│                       └[∘]│                 │     ┌[∘]      │           │     ┌[∘]            │"
            "│                           │                 └<G=G>┤         │           └[G=G]┤               │"
            "│                           │                       └[∘]      │                 │     ┌[∘]      │"
            "│                           │                                 │                 └<H=H>┤         │"
            "│                           │                                 │                       └[∘]      │"
            "├───────────────────────────┼─────────────────────────────────┼─────────────────────────────────┤"
            "│                 ┌[∘]      │                 ┌[∘]            │                 ┌[∘]            │"
            "│           ┌[A=A]┤         │           ┌[A=A]┤               │           ┌[A=A]┤               │"
            "│           │     └[∘]      │           │     └[∘]            │           │     └[∘]            │"
            "│     ┌<B=B>┤               │     ┌[B=B]┤                     │     ┌[B=B]┤                     │"
            "│     │     │     ┌[∘]      │     │     │     ┌[∘]            │     │     │     ┌[∘]            │"
            "│     │     └[C=C]┤         │     │     └[C=C]┤               │     │     └[C=C]┤               │"
            "│     │           └[∘]      │     │           └[∘]            │     │           └[∘]            │"
            "│[D=D]┤                     │[D=D]┤                           │[D=D]┤                           │"
            "│     │           ┌[∘]      │     │           ┌[∘]            │     │           ┌[∘]            │"
            "│     │     ┌[E=E]┤         │     │     ┌[E=E]┤               │     │     ┌[E=E]┤               │"
            "│     │     │     └[∘]      │     │     │     └[∘]            │     │     │     └[∘]            │"
            "│     └<F=F>┤               │     └[F=F]┤                     │     └[F=F]┤                     │"
            "│           │           ┌[∘]│           │           ┌[∘]      │           │           ┌[∘]      │"
            "│           │     ┌<G=G>┤   │           │     ┌[G=G]┤         │           │     ┌[G=G]┤         │"
            "│           │     │     └[∘]│           │     │     └[∘]      │           │     │     └[∘]      │"
            "│           └[H=H]┤         │           └<H=H>┤               │           └<H=H>┤               │"
            "│                 │     ┌[∘]│                 │     ┌[∘]      │                 │           ┌[∘]│"
            "│                 └<I=I>┤   │                 └[I=I]┤         │                 │     ┌<I=I>┤   │"
            "│                       └[∘]│                       │     ┌[∘]│                 │     │     └[∘]│"
            "│                           │                       └<J=J>┤   │                 └[J=J]┤         │"
            "│                           │                             └[∘]│                       │     ┌[∘]│"
            "│                           │                                 │                       └<K=K>┤   │"
            "│                           │                                 │                             └[∘]│"
            "└───────────────────────────┴─────────────────────────────────┴─────────────────────────────────┘"))
         (is "↓disp 4 3⍴fmt¨(tree 12↑⎕a)∘(rem foldl)¨kseq"
             #("┌─────────────────────────────────┬───────────────────────────┬───────────────────────────┐"
               "│                 ┌[∘]            │                 ┌[∘]      │                 ┌[∘]      │"
               "│           ┌[A=A]┤               │           ┌[B=B]┤         │           ┌[C=C]┤         │"
               "│           │     └[∘]            │           │     │     ┌[∘]│           │     └[∘]      │"
               "│     ┌[B=B]┤                     │           │     └<C=C>┤   │     ┌[D=D]┤               │"
               "│     │     │     ┌[∘]            │           │           └[∘]│     │     │           ┌[∘]│"
               "│     │     └[C=C]┤               │     ┌[D=D]┤               │     │     │     ┌[E=E]┤   │"
               "│     │           └[∘]            │     │     │           ┌[∘]│     │     │     │     └[∘]│"
               "│[D=D]┤                           │     │     │     ┌[E=E]┤   │     │     └<F=F>┤         │"
               "│     │                 ┌[∘]      │     │     │     │     └[∘]│     │           │     ┌[∘]│"
               "│     │           ┌[E=E]┤         │     │     └<F=F>┤         │     │           └[G=G]┤   │"
               "│     │           │     └[∘]      │     │           │     ┌[∘]│     │                 └[∘]│"
               "│     │     ┌<F=F>┤               │     │           └[G=G]┤   │[H=H]┤                     │"
               "│     │     │     │     ┌[∘]      │     │                 └[∘]│     │           ┌[∘]      │"
               "│     │     │     └[G=G]┤         │[H=H]┤                     │     │     ┌[I=I]┤         │"
               "│     │     │           └[∘]      │     │           ┌[∘]      │     │     │     └[∘]      │"
               "│     └[H=H]┤                     │     │     ┌[I=I]┤         │     └[J=J]┤               │"
               "│           │           ┌[∘]      │     │     │     └[∘]      │           │     ┌[∘]      │"
               "│           │     ┌[I=I]┤         │     └[J=J]┤               │           └[K=K]┤         │"
               "│           │     │     └[∘]      │           │     ┌[∘]      │                 │     ┌[∘]│"
               "│           └<J=J>┤               │           └[K=K]┤         │                 └<L=L>┤   │"
               "│                 │     ┌[∘]      │                 │     ┌[∘]│                       └[∘]│"
               "│                 └[K=K]┤         │                 └<L=L>┤   │                           │"
               "│                       │     ┌[∘]│                       └[∘]│                           │"
               "│                       └<L=L>┤   │                           │                           │"
               "│                             └[∘]│                           │                           │"
               "├─────────────────────────────────┼───────────────────────────┼───────────────────────────┤"
               "│                 ┌[∘]            │                 ┌[∘]      │           ┌[∘]            │"
               "│           ┌[D=D]┤               │           ┌[E=E]┤         │     ┌[F=F]┤               │"
               "│           │     │     ┌[∘]      │           │     └[∘]      │     │     │     ┌[∘]      │"
               "│           │     └<E=E>┤         │     ┌[F=F]┤               │     │     └<G=G>┤         │"
               "│           │           └[∘]      │     │     │     ┌[∘]      │     │           └[∘]      │"
               "│     ┌[F=F]┤                     │     │     └[G=G]┤         │[H=H]┤                     │"
               "│     │     │     ┌[∘]            │     │           └[∘]      │     │           ┌[∘]      │"
               "│     │     └[G=G]┤               │[H=H]┤                     │     │     ┌[I=I]┤         │"
               "│     │           └[∘]            │     │           ┌[∘]      │     │     │     └[∘]      │"
               "│[H=H]┤                           │     │     ┌[I=I]┤         │     └<J=J>┤               │"
               "│     │           ┌[∘]            │     │     │     └[∘]      │           │     ┌[∘]      │"
               "│     │     ┌[I=I]┤               │     └[J=J]┤               │           └[K=K]┤         │"
               "│     │     │     └[∘]            │           │     ┌[∘]      │                 │     ┌[∘]│"
               "│     └[J=J]┤                     │           └[K=K]┤         │                 └<L=L>┤   │"
               "│           │     ┌[∘]            │                 │     ┌[∘]│                       └[∘]│"
               "│           └[K=K]┤               │                 └<L=L>┤   │                           │"
               "│                 │     ┌[∘]      │                       └[∘]│                           │"
               "│                 └<L=L>┤         │                           │                           │"
               "│                       └[∘]      │                           │                           │"
               "├─────────────────────────────────┼───────────────────────────┼───────────────────────────┤"
               "│           ┌[∘]                  │           ┌[∘]            │           ┌[∘]            │"
               "│     ┌[G=G]┤                     │     ┌[H=H]┤               │     ┌[I=I]┤               │"
               "│     │     └[∘]                  │     │     │     ┌[∘]      │     │     └[∘]            │"
               "│[H=H]┤                           │     │     └<I=I>┤         │[J=J]┤                     │"
               "│     │           ┌[∘]            │     │           └[∘]      │     │     ┌[∘]            │"
               "│     │     ┌[I=I]┤               │[J=J]┤                     │     └[K=K]┤               │"
               "│     │     │     └[∘]            │     │     ┌[∘]            │           │     ┌[∘]      │"
               "│     └<J=J>┤                     │     └[K=K]┤               │           └<L=L>┤         │"
               "│           │     ┌[∘]            │           │     ┌[∘]      │                 └[∘]      │"
               "│           └[K=K]┤               │           └<L=L>┤         │                           │"
               "│                 │     ┌[∘]      │                 └[∘]      │                           │"
               "│                 └<L=L>┤         │                           │                           │"
               "│                       └[∘]      │                           │                           │"
               "├─────────────────────────────────┼───────────────────────────┼───────────────────────────┤"
               "│           ┌[∘]                  │     ┌[∘]                  │     ┌[∘]                  │"
               "│     ┌[J=J]┤                     │[K=K]┤                     │[L=L]┤                     │"
               "│     │     └[∘]                  │     │     ┌[∘]            │     └[∘]                  │"
               "│[K=K]┤                           │     └<L=L>┤               │                           │"
               "│     │     ┌[∘]                  │           └[∘]            │                           │"
               "│     └[L=L]┤                     │                           │                           │"
               "│           └[∘]                  │                           │                           │"
               "└─────────────────────────────────┴───────────────────────────┴───────────────────────────┘"))
         (provision "put ← '∪' splay ⋄ get ← '⍎' splay ⋄ rem ← '~' splay")
         (provision "fmt ← '⍕' splay ⋄ chk ← '?' splay ⋄ vec ← '∊' splay ⋄ dep ← '≡' splay")
         (provision "tree←0∘(put foldl)")
         (is "↓fmt tree pairs" #("            ┌five=5              "
                                 "     ┌four=4┘                    "
                                 "one=1┤                           "
                                 "     │                   ┌seven=7"
                                 "     │             ┌six=6┘       "
                                 "     │     ┌three=3┘             "
                                 "     └two=2┘                     "))
         (is "pairs[⍋↑⊃¨pairs] ≡ vec tree pairs" 1)
         (is "↓fmt tree 4 2 1 3 6 5 7" #("       ┌1=1"
                                         "   ┌2=2┤   "
                                         "   │   └3=3"
                                         "4=4┤       "
                                         "   │   ┌5=5"
                                         "   └6=6┤   "
                                         "       └7=7"))
         (is "↓fmt tree ⍳10" #("1=1┐                                     "
                               "   └2=2┐                                 "
                               "       └3=3┐                             "
                               "           └4=4┐                         "
                               "               └5=5┐                     "
                               "                   └6=6┐                 "
                               "                       └7=7┐             "
                               "                           └8=8┐         "
                               "                               └9=9┐     "
                               "                                   └10=10"))
         (provision "try←{↑fmt\\¨↑∘(get/)traj ⍺,⊂tree ⍵}")
         (is "↓disp 10 try ⍳10" #("┌──┬─────────────────────────────────────────┐"
                                  "│10│1=1┐                                     │"
                                  "│  │   └2=2┐                                 │"
                                  "│  │       └3=3┐                             │"
                                  "│  │           └4=4┐                         │"
                                  "│  │               └5=5┐                     │"
                                  "│  │                   └6=6┐                 │"
                                  "│  │                       └7=7┐             │"
                                  "│  │                           └8=8┐         │"
                                  "│  │                               └9=9┐     │"
                                  "│  │                                   └10=10│"
                                  "├──┼─────────────────────────────────────────┤"
                                  "│10│1=1┐                                     │"
                                  "│  │   └2=2┐                                 │"
                                  "│  │       └3=3┐                             │"
                                  "│  │           └4=4┐                         │"
                                  "│  │               └5=5┐                     │"
                                  "│  │                   └6=6┐                 │"
                                  "│  │                       └7=7┐             │"
                                  "│  │                           │         ┌8=8│"
                                  "│  │                           │     ┌9=9┘   │"
                                  "│  │                           └10=10┘       │"
                                  "├──┼─────────────────────────────────────────┤"
                                  "│10│1=1┐                                     │"
                                  "│  │   └2=2┐                                 │"
                                  "│  │       └3=3┐                             │"
                                  "│  │           └4=4┐                         │"
                                  "│  │               └5=5┐                     │"
                                  "│  │                   │         ┌6=6        │"
                                  "│  │                   │     ┌7=7┤           │"
                                  "│  │                   │     │   │   ┌8=8    │"
                                  "│  │                   │     │   └9=9┘       │"
                                  "│  │                   └10=10┘               │"
                                  "├──┼─────────────────────────────────────────┤"
                                  "│10│1=1┐                                     │"
                                  "│  │   └2=2┐                                 │"
                                  "│  │       └3=3┐                             │"
                                  "│  │           │         ┌4=4                │"
                                  "│  │           │     ┌5=5┤                   │"
                                  "│  │           │     │   │   ┌6=6            │"
                                  "│  │           │     │   └7=7┤               │"
                                  "│  │           │     │       │   ┌8=8        │"
                                  "│  │           │     │       └9=9┘           │"
                                  "│  │           └10=10┘                       │"
                                  "├──┼─────────────────────────────────────────┤"
                                  "│10│1=1┐                                     │"
                                  "│  │   │         ┌2=2                        │"
                                  "│  │   │     ┌3=3┤                           │"
                                  "│  │   │     │   │   ┌4=4                    │"
                                  "│  │   │     │   └5=5┤                       │"
                                  "│  │   │     │       │   ┌6=6                │"
                                  "│  │   │     │       └7=7┤                   │"
                                  "│  │   │     │           │   ┌8=8            │"
                                  "│  │   │     │           └9=9┘               │"
                                  "│  │   └10=10┘                               │"
                                  "├──┼─────────────────────────────────────────┤"
                                  "│10│     ┌1=1┐                               │"
                                  "│  │     │   │   ┌2=2                        │"
                                  "│  │     │   └3=3┤                           │"
                                  "│  │     │       │   ┌4=4                    │"
                                  "│  │     │       └5=5┤                       │"
                                  "│  │     │           │   ┌6=6                │"
                                  "│  │     │           └7=7┤                   │"
                                  "│  │     │               │   ┌8=8            │"
                                  "│  │     │               └9=9┘               │"
                                  "│  │10=10┘                                   │"
                                  "└──┴─────────────────────────────────────────┘"))
         (is "↓disp 1 try ⌽⍳10" #("┌─┬─────────────────────────────────────────┐"
                                  "│1│                                     ┌1=1│"
                                  "│ │                                 ┌2=2┘   │"
                                  "│ │                             ┌3=3┘       │"
                                  "│ │                         ┌4=4┘           │"
                                  "│ │                     ┌5=5┘               │"
                                  "│ │                 ┌6=6┘                   │"
                                  "│ │             ┌7=7┘                       │"
                                  "│ │         ┌8=8┘                           │"
                                  "│ │     ┌9=9┘                               │"
                                  "│ │10=10┘                                   │"
                                  "├─┼─────────────────────────────────────────┤"
                                  "│1│                             ┌1=1┐       │"
                                  "│ │                             │   └2=2┐   │"
                                  "│ │                             │       └3=3│"
                                  "│ │                         ┌4=4┘           │"
                                  "│ │                     ┌5=5┘               │"
                                  "│ │                 ┌6=6┘                   │"
                                  "│ │             ┌7=7┘                       │"
                                  "│ │         ┌8=8┘                           │"
                                  "│ │     ┌9=9┘                               │"
                                  "│ │10=10┘                                   │"
                                  "├─┼─────────────────────────────────────────┤"
                                  "│1│                     ┌1=1┐               │"
                                  "│ │                     │   │   ┌2=2┐       │"
                                  "│ │                     │   │   │   └3=3    │"
                                  "│ │                     │   └4=4┤           │"
                                  "│ │                     │       └5=5        │"
                                  "│ │                 ┌6=6┘                   │"
                                  "│ │             ┌7=7┘                       │"
                                  "│ │         ┌8=8┘                           │"
                                  "│ │     ┌9=9┘                               │"
                                  "│ │10=10┘                                   │"
                                  "├─┼─────────────────────────────────────────┤"
                                  "│1│             ┌1=1┐                       │"
                                  "│ │             │   │       ┌2=2┐           │"
                                  "│ │             │   │       │   └3=3        │"
                                  "│ │             │   │   ┌4=4┤               │"
                                  "│ │             │   │   │   └5=5            │"
                                  "│ │             │   └6=6┤                   │"
                                  "│ │             │       └7=7                │"
                                  "│ │         ┌8=8┘                           │"
                                  "│ │     ┌9=9┘                               │"
                                  "│ │10=10┘                                   │"
                                  "├─┼─────────────────────────────────────────┤"
                                  "│1│     ┌1=1┐                               │"
                                  "│ │     │   │           ┌2=2┐               │"
                                  "│ │     │   │           │   └3=3            │"
                                  "│ │     │   │       ┌4=4┤                   │"
                                  "│ │     │   │       │   └5=5                │"
                                  "│ │     │   │   ┌6=6┤                       │"
                                  "│ │     │   │   │   └7=7                    │"
                                  "│ │     │   └8=8┤                           │"
                                  "│ │     │       └9=9                        │"
                                  "│ │10=10┘                                   │"
                                  "├─┼─────────────────────────────────────────┤"
                                  "│1│1=1┐                                     │"
                                  "│ │   │                 ┌2=2┐               │"
                                  "│ │   │                 │   └3=3            │"
                                  "│ │   │             ┌4=4┤                   │"
                                  "│ │   │             │   └5=5                │"
                                  "│ │   │         ┌6=6┤                       │"
                                  "│ │   │         │   └7=7                    │"
                                  "│ │   │     ┌8=8┤                           │"
                                  "│ │   │     │   └9=9                        │"
                                  "│ │   └10=10┘                               │"
                                  "└─┴─────────────────────────────────────────┘"))
         (is "↓disp 1 try 3 2 1" #("┌─┬───────────┐"
                                   "│1│       ┌1=1│"
                                   "│ │   ┌2=2┘   │"
                                   "│ │3=3┘       │"
                                   "├─┼───────────┤"
                                   "│1│1=1┐       │"
                                   "│ │   └2=2┐   │"
                                   "│ │       └3=3│"
                                   "└─┴───────────┘"))
         (is "↓disp 3 try 4 2 3" #("┌─┬───────────┐"
                                   "│3│   ┌2=2┐   │"
                                   "│ │   │   └3=3│"
                                   "│ │4=4┘       │"
                                   "├─┼───────────┤"
                                   "│3│   ┌2=2    │"
                                   "│ │3=3┤       │"
                                   "│ │   └4=4    │"
                                   "└─┴───────────┘"))
         (is "chk tree ⍳7" #(1 7 3 7))
         (provision "⎕rl ← 7*5")
         (provision "tt  ← tree 256?256")
         (is "chk tt" #(1 256 9 17))
         (provision "revt←{⊃⌽⍵ get ⍺}")
         (provision "tt ← tt revt foldl 256?256")
         (is "chk tt" #(1 256 15 34))
         (provision "keys←16?256")
         (is "keys dep¨⊂tt" #(10 9 12 6 14 11 10 9 31 13 10 27 20 13 21 29))
         (provision "tt ← tt revt foldl 16/keys")
         (is "keys dep¨⊂tt" #(7 5 6 5 7 5 4 6 4 2 4 5 2 3 3 1))
         (is "chk tt" #(1 256 8 18))
         (is "tt rem foldl 256?256" 0)
         (is "↓tfmt 'tea'" #("tea"))
         (is "↓tfmt 'hot' 'tea' 'coffee'" #("hot       "
                                            "·   tea   "
                                            "·   coffee"))
         (is "↓tfmt'drink'('hot' 'tea' 'coffee')('cold' 'milk' 'beer')"
             #("drink         "
               "·   hot       "
               "·   ·   tea   "
               "·   ·   coffee"
               "·   cold      "
               "·   ·   milk  "
               "·   ·   beer  "))
         (is "tnest ,∘⊂¨0 'tea'" "tea")
         (is "↓disp tnest (0 1 1)('hot' 'tea' 'coffee')" #("┌───┬───┬──────┐"
                                                           "│hot│tea│coffee│"
                                                           "└───┴───┴──────┘"))
         (is "↓disp tnest (0 1 2 2 1 2 2)('drink' 'hot' 'tea' 'coffee' 'cold' 'milk' 'beer')"
             #("┌─────┬────────────────┬────────────────┐"
               "│drink│┌───┬───┬──────┐│┌────┬────┬────┐│"
               "│     ││hot│tea│coffee│││cold│milk│beer││"
               "│     │└───┴───┴──────┘│└────┴────┴────┘│"
               "└─────┴────────────────┴────────────────┘"))
         (is "↓disp tnest(0 1 1 1 1 1 1 1)(↓8 3⍴⎕a)" #("┌───┬───┬───┬───┬───┬───┬───┬───┐"
                                                       "│ABC│DEF│GHI│JKL│MNO│PQR│STU│VWX│"
                                                       "└───┴───┴───┴───┴───┴───┴───┴───┘"))
         (is "↓disp tnest(0 1 2 1 1 1 1 1)(↓8 3⍴⎕a)" #("┌───┬─────────┬───┬───┬───┬───┬───┐"
                                                       "│ABC│┌───┬───┐│JKL│MNO│PQR│STU│VWX│"
                                                       "│   ││DEF│GHI││   │   │   │   │   │"
                                                       "│   │└───┴───┘│   │   │   │   │   │"
                                                       "└───┴─────────┴───┴───┴───┴───┴───┘"))
         (is "↓disp tnest(0 1 2 1 2 1 1 1)(↓8 3⍴⎕a)" #("┌───┬─────────┬─────────┬───┬───┬───┐"
                                                       "│ABC│┌───┬───┐│┌───┬───┐│PQR│STU│VWX│"
                                                       "│   ││DEF│GHI│││JKL│MNO││   │   │   │"
                                                       "│   │└───┴───┘│└───┴───┘│   │   │   │"
                                                       "└───┴─────────┴─────────┴───┴───┴───┘"))
         (is "↓disp tnest(0 1 2 2 2 1 1 1)(↓8 3⍴⎕a)" #("┌───┬─────────────────┬───┬───┬───┐"
                                                       "│ABC│┌───┬───┬───┬───┐│PQR│STU│VWX│"
                                                       "│   ││DEF│GHI│JKL│MNO││   │   │   │"
                                                       "│   │└───┴───┴───┴───┘│   │   │   │"
                                                       "└───┴─────────────────┴───┴───┴───┘"))
         (is "↓disp tnest(0 1 1 2 2 1 2 1)(↓8 3⍴⎕a)" #("┌───┬───┬─────────────┬─────────┬───┐"
                                                       "│ABC│DEF│┌───┬───┬───┐│┌───┬───┐│VWX│"
                                                       "│   │   ││GHI│JKL│MNO│││PQR│STU││   │"
                                                       "│   │   │└───┴───┴───┘│└───┴───┘│   │"
                                                       "└───┴───┴─────────────┴─────────┴───┘"))
         (is "↓disp tnest(0 1 2 3 1 2 3 1)(↓8 3⍴⎕a)" #("┌───┬───────────────┬───────────────┬───┐"
                                                       "│ABC│┌───┬─────────┐│┌───┬─────────┐│VWX│"
                                                       "│   ││DEF│┌───┬───┐│││MNO│┌───┬───┐││   │"
                                                       "│   ││   ││GHI│JKL││││   ││PQR│STU│││   │"
                                                       "│   ││   │└───┴───┘│││   │└───┴───┘││   │"
                                                       "│   │└───┴─────────┘│└───┴─────────┘│   │"
                                                       "└───┴───────────────┴───────────────┴───┘"))
         (is "↓disp tview'tea'" #("┌─┬─────┐"
                                  "│0│┌───┐│"
                                  "│ ││tea││"
                                  "│ │└───┘│"
                                  "└─┴─────┘"))
         (is "↓disp tview'hot' 'tea' 'coffee'" #("┌─────┬────────────────┐"
                                                 "│0 1 1│┌───┬───┬──────┐│"
                                                 "│     ││hot│tea│coffee││"
                                                 "│     │└───┴───┴──────┘│"
                                                 "└─────┴────────────────┘"))
         (is "↓disp tview'drink'('hot' 'tea' 'coffee')('cold' 'milk' 'beer')"
             #("┌─────────────┬─────────────────────────────────────┐"
               "│0 1 2 2 1 2 2│┌─────┬───┬───┬──────┬────┬────┬────┐│"
               "│             ││drink│hot│tea│coffee│cold│milk│beer││"
               "│             │└─────┴───┴───┴──────┴────┴────┴────┘│"
               "└─────────────┴─────────────────────────────────────┘"))))
